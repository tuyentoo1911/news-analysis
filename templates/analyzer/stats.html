{% extends 'base.html' %}
{% load static %}
{% load analyzer_extras %}

{% block title %}Thống kê - THYNK UNLIMITED{% endblock %}

{% block content %}
<div class="row">
  <div class="col-12">
    <h2 class="text-center mb-4">Thống kê hệ thống</h2>
    <p class="text-center text-muted mb-5">
      Tổng quan về hoạt động phân tích tin tức
    </p>
  </div>
</div>

<!-- Overview Stats -->
<div class="row mb-5">
  <div class="col-md-3 mb-4">
    <div class="card text-center shadow-sm">
      <div class="card-body">
        <i class="fas fa-newspaper fa-3x text-primary mb-3"></i>
        <h3 class="text-primary">{{ total_articles|default:0 }}</h3>
        <p class="text-muted mb-0">Tổng tin tức</p>
      </div>
    </div>
  </div>
  <div class="col-md-3 mb-4">
    <div class="card text-center shadow-sm">
      <div class="card-body">
        <i class="fas fa-chart-line fa-3x text-success mb-3"></i>
        <h3 class="text-success">{{ total_analyses|default:0 }}</h3>
        <p class="text-muted mb-0">Lượt phân tích</p>
      </div>
    </div>
  </div>
  <div class="col-md-3 mb-4">
    <div class="card text-center shadow-sm">
      <div class="card-body">
        <i class="fas fa-exclamation-triangle fa-3x text-danger mb-3"></i>
        <h3 class="text-danger">{{ fake_count|default:0 }}</h3>
        <p class="text-muted mb-0">Tin giả phát hiện</p>
      </div>
    </div>
  </div>
  <div class="col-md-3 mb-4">
    <div class="card text-center shadow-sm">
      <div class="card-body">
        <i class="fas fa-check-circle fa-3x text-info mb-3"></i>
        <h3 class="text-info">{{ real_count|default:0 }}</h3>
        <p class="text-muted mb-0">Tin thật xác nhận</p>
      </div>
    </div>
  </div>
</div>

<!-- Charts Section -->
<div class="row">
  <div class="col-lg-6 mb-4">
    <div class="card shadow">
      <div class="card-header">
        <h5 class="mb-0">
          <i class="fas fa-pie-chart me-2"></i>Tỷ lệ tin thật/giả
        </h5>
      </div>
      <div class="card-body">
        {% if total_analyses > 0 %}
        <div class="text-center">
          <canvas id="truthChart" width="300" height="300"></canvas>
        </div>
        <div class="row mt-3">
          <div class="col-6 text-center">
            <span class="badge bg-success fs-6"
              >Tin thật: {{ real_percentage|default:0 }}%</span
            >
          </div>
          <div class="col-6 text-center">
            <span class="badge bg-danger fs-6"
              >Tin giả: {{ fake_percentage|default:0 }}%</span
            >
          </div>
        </div>
        {% else %}
        <div class="text-center text-muted py-5">
          <i class="fas fa-chart-pie fa-3x mb-3"></i>
          <p>Chưa có dữ liệu để hiển thị</p>
        </div>
        {% endif %}
      </div>
    </div>
  </div>

  <div class="col-lg-6 mb-4">
    <div class="card shadow">
      <div class="card-header">
        <h5 class="mb-0">
          <i class="fas fa-chart-bar me-2"></i>Thống kê chi tiết
        </h5>
      </div>
      <div class="card-body">
        <div class="mb-3">
          <div class="d-flex justify-content-between align-items-center mb-2">
            <span>Tin thật</span>
            <span class="badge bg-success">{{ real_count|default:0 }}</span>
          </div>
          <div class="progress">
            <div
              class="progress-bar bg-success"
              role="progressbar"
              style="width: {% if total_analyses > 0 %}{{ real_percentage }}%{% else %}0%{% endif %}"
            ></div>
          </div>
        </div>

        <div class="mb-3">
          <div class="d-flex justify-content-between align-items-center mb-2">
            <span>Tin giả</span>
            <span class="badge bg-danger">{{ fake_count|default:0 }}</span>
          </div>
          <div class="progress">
            <div
              class="progress-bar bg-danger"
              role="progressbar"
              style="width: {% if total_analyses > 0 %}{{ fake_percentage }}%{% else %}0%{% endif %}"
            ></div>
          </div>
        </div>

        <div class="mt-4">
          <h6 class="text-muted">Tỷ lệ chính xác hệ thống</h6>
          <div class="progress" style="height: 25px">
            <div
              class="progress-bar bg-primary"
              role="progressbar"
              style="width: 95%"
            >
              95%
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Additional Info -->
<div class="row">
  <div class="col-12">
    <div class="card shadow">
      <div class="card-header">
        <h5 class="mb-0">
          <i class="fas fa-info-circle me-2"></i>Thông tin hệ thống
        </h5>
      </div>
      <div class="card-body">
        <div class="row">
          <div class="col-md-6">
            <h6>Mô hình AI</h6>
            <p class="text-muted">
              Sử dụng mô hình Machine Learning tiên tiến để phân tích
            </p>

            <h6>Độ chính xác</h6>
            <p class="text-muted">
              Đạt độ chính xác 95% trên tập dữ liệu kiểm thử
            </p>
          </div>
          <div class="col-md-6">
            <h6>Ngôn ngữ hỗ trợ</h6>
            <p class="text-muted">Tiếng Việt, tối ưu cho tin tức Việt Nam</p>

            <h6>Cập nhật</h6>
            <p class="text-muted">
              Mô hình được cập nhật định kỳ để cải thiện hiệu suất
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  // Chart cho tỷ lệ tin thật/giả
  const ctx = document.getElementById('truthChart');
  if (ctx && {{ total_analyses|default:0 }} > 0) {
      new Chart(ctx, {
          type: 'doughnut',
          data: {
              labels: ['Tin thật', 'Tin giả'],
              datasets: [{
                  data: [{{ real_count|default:0 }}, {{ fake_count|default:0 }}],
                  backgroundColor: ['#28a745', '#dc3545'],
                  borderWidth: 0
              }]
          },
          options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                  legend: {
                      position: 'bottom'
                  }
              }
          }
      });
  }
</script>
{% endblock %}

